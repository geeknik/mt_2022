#!/bin/bash

realpath() {
    [[ $1 = /* ]] && echo "$1" || echo "$PWD/${1#./}"
}

rm -rf tmp
rm -rf fixed
rm -rf broken

mkdir tmp
mkdir fixed
mkdir broken

git clone $2 tmp

cd tmp

git fetch
git checkout $1

for path in `git diff-tree --no-commit-id --name-only -r $1`;
do 
    if [[ $path == *.js ]] && [[ $path != *test* ]]
    then mv $path ../fixed
    fi
done

git checkout $1^1

for path in `git diff-tree --no-commit-id --name-only -r $1`;
do 
    if [[ $path == *.js ]] && [[ $path != *test* ]]
    then mv $path ../broken
    fi
done

cd ..
rm -rf tmp

for filename in broken/*; do
    node show_ast "$(realpath $filename)" "$(realpath fixed/$(basename $filename))" "$3" "$4" "$5" "$6"
done



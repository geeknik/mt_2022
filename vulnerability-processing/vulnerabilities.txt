TODO:
1. Modifikace run.sh skriptu, aby uměl brát i http url zranitelnosti a patche
2. Doplnit plain JS zranitelnosti
3. najít npm zranitelnosti
4. odfiltrovat typescript


// porovnání dvou přístupů - detekce celý jQeury buildů
// jQuery AST mají bez optimalizací 463MB
// oproti detekci konkrétních zranitelných jednotek


TOP 4 Javascript libraries
https://w3techs.com/technologies/overview/javascript_library

jQuery	https://github.com/advisories?query=jQuery
https://github.com/advisories/GHSA-2pqj-h3vj-pqgw >= 1.7.1, <= 1.8.3    1.9.0
https://github.com/advisories/GHSA-q4m3-2j7h-f7xw < 1.9.0               1.9.0
https://github.com/advisories/GHSA-jpcq-cgw6-v4j6 >= 1.0.3, < 3.5.0     3.5.0
https://github.com/advisories/GHSA-gxr4-xjj5-5px2 >= 1.2, < 3.5.0       3.5.0
https://github.com/advisories/GHSA-6c3j-c64m-qhgq < 3.4.0               3.4.0
https://github.com/advisories/GHSA-mhpp-875w-9cpv > 2.1.0, < 3.0.0      3.0.0
https://github.com/advisories/GHSA-rmxg-73gg-4p98 < 3.0.0               3.0.0

všechny jquery pod 3.5 jsou zranitelné
https://github.com/advisories/GHSA-jpcq-cgw6-v4j6 >= 1.0.3, < 3.5.0     3.5.0
update na 3.5.0+

CDN https://releases.jquery.com/jquery/


Bootstrap	https://github.com/advisories?query=Bootstrap
https://github.com/advisories/GHSA-wh77-3x4m-4q9g
https://github.com/advisories/GHSA-ph58-4vrj-w6hr
https://github.com/advisories/GHSA-4p24-vmcr-4gqj
https://github.com/advisories/GHSA-pj7m-g53m-7638

upadte 4+ na 4.3.1
update 3+ na 3.4.1

Underscore	https://github.com/advisories?query=Underscore
https://github.com/advisories/GHSA-cf4h-3jhx-xvhq
1.13.0-0 na 1.13.0-2
1.3.2 na 1.12.1 

TOP 100 Npm packages by popularity
https://gist.github.com/anvaka/8e8fa57c7ee1350e3491

lodash - 69147 
https://github.com/advisories/GHSA-35jh-r3h4-6jhm < 4.17.21   4.17.21
https://github.com/advisories/GHSA-p6mc-m468-83gw < 4.17.20   4.17.20
https://github.com/advisories/GHSA-x5rq-j2xg-h7qm < 4.17.11   4.17.11
https://github.com/advisories/GHSA-jf85-cpcp-j695 < 4.17.12   4.17.12
https://github.com/advisories/GHSA-4xc9-xhrj-v574 < 4.17.11   4.17.11
https://github.com/advisories/GHSA-fvqr-27wr-82fm < 4.17.5    4.17.5

request - 35681
https://github.com/advisories/GHSA-7xfp-9c55-5vqj >= 2.49.0, < 2.68.0   2.68.0
>= 2.2.6, < 2.47.0   2.68.0

react - 30604
https://github.com/advisories/GHSA-g53w-52xc-2j85
https://github.com/advisories/GHSA-hg79-j56m-fxgv

express - 27420
https://github.com/advisories/GHSA-gpvr-g6gh-9mc2

debug - 23285
https://github.com/advisories/GHSA-gxpj-cx7g-858c

moment - 21387
https://github.com/advisories/GHSA-hxf5-mg84-pj4m
https://github.com/advisories/GHSA-446m-mv8f-q348
https://github.com/advisories/GHSA-87vv-r9j6-g5qv

react-dom - 20411
https://github.com/advisories/GHSA-mvjj-gqq2-p4hw

underscore - 16870
https://github.com/advisories/GHSA-cf4h-3jhx-xvhq

axios - 15622
https://github.com/advisories/GHSA-42xw-2xvc-qx8m <= 0.18.0    0.18.1
https://github.com/advisories/GHSA-4w2v-q235-vp99 < 0.21.1     0.21.1
https://github.com/advisories/GHSA-cph5-m8f7-6c5x <= 0.21.1    0.21.2

colors - 12754
https://github.com/advisories/GHSA-gh88-3pxp-6fm8
https://github.com/advisories/GHSA-5rqg-jm4f-cqx7

minimist - 11310
https://github.com/advisories/GHSA-xvch-5gv4-984h
https://github.com/advisories/GHSA-vh95-rmgr-6w4m

jquery - 10708
https://github.com/advisories/GHSA-2pqj-h3vj-pqgw
https://github.com/advisories/GHSA-q4m3-2j7h-f7xw
https://github.com/advisories/GHSA-jpcq-cgw6-v4j6
https://github.com/advisories/GHSA-gxr4-xjj5-5px2
https://github.com/advisories/GHSA-6c3j-c64m-qhgq
https://github.com/advisories/GHSA-wv67-q8rr-grjp
https://github.com/advisories/GHSA-mhpp-875w-9cpv
https://github.com/advisories/GHSA-rmxg-73gg-4p98

semver - 8746
https://github.com/advisories/GHSA-x6fg-f45m-jf5q

shelljs - 7601
https://github.com/advisories/GHSA-4rq4-32rv-6wp6
https://github.com/advisories/GHSA-64g7-mvw6-v9qj

js-yaml - 6983
https://github.com/advisories/GHSA-2pr6-76vf-7546
https://github.com/advisories/GHSA-8j8c-7jfh-h6hx
https://github.com/advisories/GHSA-xxvw-45rp-3mj2

node-fetch - 5892
https://github.com/advisories/GHSA-r683-j2x4-v87g
https://github.com/advisories/GHSA-w7rc-rwvf-8q5r

handlebars - 5809
https://github.com/advisories/GHSA-765h-qjxv-5f44
https://github.com/advisories/GHSA-62gr-4qp9-h98f
https://github.com/advisories/GHSA-3cqr-58rm-57f8
https://github.com/advisories/GHSA-f2jv-r9rf-7988
https://github.com/advisories/GHSA-q2c6-c6pm-g3gh
https://github.com/advisories/GHSA-g9r4-xpmj-mj65
https://github.com/advisories/GHSA-2cf5-4w76-r9qv
https://github.com/advisories/GHSA-f52g-6jhx-586p
https://github.com/advisories/GHSA-w457-6q6x-cgp9
https://github.com/advisories/GHSA-q42p-pg8m-cqh6
https://github.com/advisories/GHSA-9prh-257w-9277
https://github.com/advisories/GHSA-fmr4-7g9q-7hc7

aws-sdk - 5599
https://github.com/advisories/GHSA-rrc9-gqf8-8rwg

webpack-dev-server - 5447
https://github.com/advisories/GHSA-cf66-xwfp-gvc4

socket.io - 5288
https://github.com/advisories/GHSA-fxwf-4rqh-v8g3
https://github.com/advisories/GHSA-qv2v-m59f-v5fw
ws - 5255
https://github.com/advisories/GHSA-6fc8-4gx4-v693
https://github.com/advisories/GHSA-5v72-xg48-5rpm
https://github.com/advisories/GHSA-6663-c963-2gqg
https://github.com/advisories/GHSA-2mhh-w6q8-5hxw

node-sass - 5121
https://github.com/advisories/GHSA-r8f7-9pfq-mjmv
https://github.com/advisories/GHSA-9v62-24cr-58cx

ejs - 4893
https://github.com/advisories/GHSA-6x77-rpqf-j6mw
https://github.com/advisories/GHSA-3w5v-p54c-f74x
https://github.com/advisories/GHSA-hwcf-pp87-7x6p

superagent - 4845
https://github.com/advisories/GHSA-8225-6cvr-8pqp

mongodb - 4664
https://github.com/advisories/GHSA-mh5c-679w-hh4r

mongoose - 4597
https://github.com/advisories/GHSA-r5xw-q988-826m
https://github.com/advisories/GHSA-8687-vv9j-hgph

bootstrap - 4490
https://github.com/advisories/GHSA-wh77-3x4m-4q9g
https://github.com/advisories/GHSA-ph58-4vrj-w6hr
https://github.com/advisories/GHSA-3mgp-fx93-9xv5
https://github.com/advisories/GHSA-4p24-vmcr-4gqj
https://github.com/advisories/GHSA-pj7m-g53m-7638

redis - 4248
https://github.com/advisories/GHSA-35q2-47q7-3pc3


Optimization 0 - one file, double for cycle for detection
Tests with couple jQueries took 1.5-2s
Tests with all compatible jQueries took 8-10s 
Size of vulnerabilities json - 453MB

Optimization 1 - extract patches to separate file, reference by id (hash of ast)
New size:
Tests with all compatible jQueries took 8-10s

Optimization 2 - no storing of entire ASTs of vulnerabilities, hash is enough to find it
- vulnerabilities are too big to process (if loaded in memory, space and time complexities grow with each new vulnerability massively)
https://www.npmjs.com/package/object-hash
During detection phase we need to create full AST and calculate hash of every node, then walk over nodes
Still probably faster then double for cycle
New size:
Test speed:

Optimization 3: ?

Need to make execution faster > KMP? hashe? limited depth?

Bonus: make patch optional/nullable, not all vulnerabilities have supported fixes, sometimes detection is enough


==> proč tohle a ne prostě hashe souborů?
- whitespace
- normalizace
- komentáře
- teoreticky podčásti podstromu u vhodných zranitelností
// var startTime = performance.now();


// console.log('Hello world from content script 1');

// // https://stackoverflow.com/questions/7933212/remove-all-script-elements-using-js/7933237
// var r = document.getElementsByTagName('script');

// for (var i = (r.length-1); i >= 0; i--) {

//     if(r[i].getAttribute('id') != 'a'){
//         r[i].parentNode.removeChild(r[i]);
//     }
// }

// var s = document.createElement('script');
// s.src = chrome.runtime.getURL('scripts/inline_script.js');
// (document.documentElement).appendChild(s);

// console.log('Hello world from content script 2');

// var endTime = performance.now();
// console.log(`Call to doSomething in content script took ${endTime - startTime} milliseconds`)


reloadAndKillJS = function () {
    document.documentElement.innerHTML = 'Reloading Page...';

    var xhr = new XMLHttpRequest();

    xhr.open('GET', window.location.href, true);

    xhr.onerror = function () {
        document.documentElement.innerHTML = 'Error getting Page';
    }

    xhr.onload = function () {
        var page = document.implementation.createHTMLDocument("");
        page.documentElement.innerHTML = this.responseText;

        var newPage = document.importNode(page.documentElement, true);




        var nodeList = newPage.querySelectorAll('script');
        for (var i = 0; i < nodeList.length; ++i) {
            var node = nodeList[i];
            if (node.src) {
                node.setAttribute('original-src', node.src);


            }
        }

        document.replaceChild(newPage, document.documentElement);
        delete page;

        var s = document.createElement('script');
        s.src = chrome.runtime.getURL('scripts/inline_script.js');
        (document.documentElement).appendChild(s);
    }

    xhr.send();
}

console.log('Hello world from content script 1');

window.stop();
console.log('Hello world from content script 2');

reloadAndKillJS();
console.log('Hello world from content script 3');
